(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{G7d5:function(e,a,t){"use strict";var r=t("mq5D");t.n(r).a},mq5D:function(e,a,t){},oX9S:function(e,a,t){"use strict";var r=t("P2sY"),o=t.n(r),i=t("4d7F"),n=t.n(i),s=t("ywuS"),d=t("20nU"),c={position:[116.458076,39.996648],draggable:!1,isPanTo:!0,content:'<div class="marker-default"></div>'},p={name:"v-map",props:{keywords:{type:String,default:""},lng:{type:String,default:"116.4514501384251588"},lat:{type:String,default:"39.9951573546932124"},img:String,location:String,placeSearch:{type:Boolean,default:!1},radius:{type:Number,default:500},locations:{type:Array,default:function(){return[]}},dragEnable:{type:Boolean,default:!1},markers:{type:Array,default:function(){return[]}},zoom:{type:Number,default:17},backAddr:{type:Boolean,default:!1}},data:function(){return{amap:null,bgStyle:{background:"url("+this.img+")","background-position":"50% 50%","background-repeat":"no-repeat","background-size":"cover"},geocoder:null,mapReady:!1,mapMarker:[],centerPos:[],page:1,pageNum:d.a.LIMIT,hasMore:!0}},watch:{markers:function(e){this.removeMarkers(),this.amap&&this.dealMap()},keywords:function(e){(""===e||/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(e))&&(this.hasMore=!0,this.searchNearBy({keywords:e,refreshTag:!0}))}},mounted:function(){var e=this;if(this.$logger.log("v-map."+this._uid+".mounted: "),s.a.$on("v-map.changeMarker",this.changeMarker),window.AMap||!this.$root.amapImportTag)this.load().then(function(){e.$logger.log("v-map."+e._uid+".mounted.then: "),e.mapReady=!0,e.init(),e.dealMap()}).catch(function(a){e.mapReady=!1,e.$logger.error("v-map."+e._uid+".mounted.error: ",a)});else{var a=0;!function t(){50<a||(a++,window.AMap?(e.$logger.log("v-map."+e._uid+".mounted.then: "),e.mapReady=!0,e.init(),e.dealMap()):setTimeout(t,50))}()}},methods:{load:function(){if(window.AMap)return n.a.resolve();this.$logger.log("v-map."+this._uid+".load: ");var e=this.createScript();return document.head.appendChild(e),new n.a(function(a,t){window.mapLoaded=function(){return a()},e.onerror=function(e){return t(e)}})},createScript:function(){this.$root.amapImportTag=!0;var e=document.createElement("script");return e.type="text/javascript",e.async=!0,e.defer=!0,e.id="amap",e.src="http://webapi.amap.com/maps?v="+d.a.AMAP_VERSION+"&key="+d.a.AMAP_KEY+"&callback=mapLoaded",e},init:function(){var e=this;this.$logger.log("v-map."+this._uid+".init: ",this.mapReady,window.AMap),this.amap=new window.AMap.Map("vAMap_"+this._uid,{dragEnable:this.dragEnable,keyboardEnable:!1,doubleClickZoom:this.dragEnable,resizeEnable:!1,zoomEnable:!0,touchZoom:!0,center:c.position,zoom:this.zoom,fixed:!1}),this.placeSearch&&(this.amap.on("moveend",this.onMoveEnd),window.AMap.service("AMap.PlaceSearch",function(){e.placeSearcher=new window.AMap.PlaceSearch({pageSize:e.pageNum,type:"汽车服务|汽车销售|汽车维修|摩托车服务|餐饮服务|购物服务|生活服务|体育休闲服务|医疗保健服务|住宿服务|风景名胜|商务住宅|政府机构及社会团体|科教文化服务|交通设施服务|金融保险服务|公司企业|道路附属设施|地名地址信息|公共设施",pageIndex:e.page,showCover:!1}),e.searchNearBy()}))},initGeocoder:function(e,a){var t=this;window.AMap.service("AMap.Geocoder",function(){t.geocoder=new window.AMap.Geocoder({radius:0,extensions:"all"}),t.geocoderPromise(e,a)})},initMarkers:function(){var e=this;this.markers.length<=0||this.markers.forEach(function(a,t){if(-180<=a.position[0]&&a.position[0]<=180&&-90<=a.position[1]&&a.position[1]<=90){var r=o()({map:e.amap,offset:new window.AMap.Pixel(0,0)},c,a),i=e.createMarker(r);e.backAddr&&e.getAddr(a.position,function(r){var o=e.dealAddress(r);a.label&&e.setLabel(a.label,o.shortAddress,i),e.$emit("getAddress",{address:o.formateAddr,shortAddress:o.shortAddress,index:t})}),e.mapMarker.push(i)}})},createMarker:function(e){return new window.AMap.Marker(e)},setFitView:function(){this.amap.setFitView()},removeMarkers:function(){this.mapMarker.length<=0||(this.amap.remove(this.mapMarker),this.mapMarker=[])},setZoomAndCenter:function(e){this.amap.setZoomAndCenter(this.zoom,e)},dealMap:function(){0!==this.markers.length&&(this.setZoomAndCenter(this.markers[0].position),this.initMarkers(),1<this.markers.length&&this.setFitView())},getAddr:function(e,a){this.geocoder?this.geocoderAddress(e,a):this.initGeocoder(e,a)},geocoderAddress:function(e,a){this.geocoder.getAddress(e,function(e,t){"complete"===e&&"OK"===t.info?a(t.regeocode):a("未能获取到地址")})},dealAddress:function(e){var a="",t="";if("string"==typeof e)a=e;else{var r=e.addressComponent;0<e.pois.length?(t=e.pois[0].address,a=e.pois[0].name):(t=e.formattedAddress,a=e.formattedAddress.replace(r.province+r.district,""))}return{address:t,shortAddress:a}},setLabel:function(e,a,t){var r=e.content;r=e.content.replace(/<em replace>.*<\/em>/g,a),t.setLabel({content:r,offset:new window.AMap.Pixel(0,0)})},onMoveEnd:function(e){var a=this.amap.getCenter();this.$logger.log("v-map.onMoveEnd: ",a)},searchNearBy:function(){var e=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=a.keywords,r=void 0===t?"":t,o=a.refreshTag,i=void 0!==o&&o;if(this.$logger.log("v-map.searchNearBy: "+r+", "+i+", "+this.page+", "+this.placeSearch+", "+this.hasMore),!this.placeSearch||!this.hasMore)return n.a.reject("placeSearch false");i&&(this.page=1),this.placeSearcher.setPageIndex(this.page);try{return this.placeSearcher.searchNearBy(r,[this.lng,this.lat],this.radius,function(a,t){e.$logger.log("v-map.searchNearBy.response: ",a,t),"complete"===a&&"OK"===t.info?(e.page+=1,e.$logger.log("v-map.searchNearBy: ",a,t),e.$emit("locations-change",{data:t.poiList.pois,refreshTag:i}),t.poiList.pois.length<e.pageNum&&(e.hasMore=!1)):e.hasMore=!1})}catch(a){return this.$logger.error("v-map.searchNearBy.error: ",a),n.a.reject("v-map.searchNearBy.error: ",a)}},markerBack:function(){this.changeMarker(c.position)},changeMarker:function(e){if(this.$logger.log("v-map.changeMarker: ",e,this.mapMarker),this.mapMarker&&!(this.mapMarker.length<1)){var a=this.mapMarker[0];this.amap.panTo(e),a.setPosition(e)}}}},h=(t("G7d5"),t("KHd+")),l=Object(h.a)(p,function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"v-map",attrs:{id:"vAMap_"+e._uid}},[e.mapReady?e._e():t("div",{staticClass:"map-loading"}),e._v(" "),e.img?t("div",{staticClass:"v-map__img",style:e.bgStyle}):e._e(),e._v(" "),e.location?t("div",{staticClass:"v-map__location"},[e._v(e._s(e.location)),t("i",{staticClass:"icon icon-arror-r"})]):e._e(),e._v(" "),t("div",{staticClass:"v-map__local",on:{click:e.markerBack}},[t("div")])])},[],!1,null,null,null);a.a=l.exports}}]);